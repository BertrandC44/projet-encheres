<!DOCTYPE html>
<html>
<head th:insert="~{fragments/liens::liens}">
<meta charset="UTF-8">
<title>ENI-Enchères</title>
</head>
<body>
 
<header th:replace="~{fragments/entete::entete}"></header>

	<h2>Filtres :</h2>
	<th:block data-th-if="${utilisateurEnSession != null and utilisateurEnSession.idUtilisateur > 0}">

		<ul>
			<label for="achats">Achats :</label>
			<input type="radio"  id="achats" value="Achats" name="achats/ventes">
			<li >
				<input type="checkbox" id="encheresOuvertes" name="encheresOuvertes"><label for="encheresOuvertes">  enchères ouvertes</label>
				<input type="checkbox" id="mesEncheresEnCours" name="mesEncheresEnCours"><label for="mesEncheresEnCours">  mes enchères en cours</label>
				<input type="checkbox" id="mesEncheresEemportees" name="mesEncheresEemportees"><label for="mesEncheresEmportees">  mes enchères remportées</label>
 
			<label for="mesVentes">Mes ventes :</label>
			<input type="radio"  id="mesVentes" value="Mes ventes" name="achats/ventes">
			<li >
				<input type="checkbox" id="mesVentesEnCours" name="mesVentesEnCours"><label for="mesVentesEnCours">  mes ventes en cours</label>
				<input type="checkbox" id="ventesNonDebutees" name="ventesNonDebutees"><label for="ventesNonDebutees">  ventes non débutées</label>
				<input type="checkbox" id="ventesTerminees" name="ventesTerminees"><label for="ventesTerminees">  ventes terminées</label>
			</li>
		
		</ul>
	</th:block>
			<a class="">
			<li>
				<label for="categories">Catégories :</label>
				<input type="text" id="categories" name="categories" disabled th:value required>
			</li>
			<li class="recherche">
				<img alt ="loupe"  width=10 src="/images/loupe.png">
				<input type="text" placeholder="Le nom de l'article contient..."></input>
			</li>
			<li>
					<button type="submit">Rechercher</button>  
			</li>
			
			</a>
			</ul>
			
			
				<h1> Ventes en cours : </h1>
					<table>
						<thead>
							<tr>
				
					<th>Nom</th>
					<th>Prix de l'article</th>
					<th>Fin de l'enchere</th>
					<th>Temps restant </th>
					<th>Retrait</th>
					<th>Utilisateur </th>
					
					
					
				</tr>
			</thead>	
			<tbody>
				<tr th:each="a : ${articles}">
					<td th:text="${a.nomArticle}"></td>
					<td th:text="${a.miseAPrix}"></td>
					<td th:text="${#temporals.format(a.dateFinEncheres,'dd-MM-yyyy HH:mm')}">
					<td>
					
					<span class="compte-rebours"
      				th:data-date-debut="${a.dateDebutEncheres}" 
      				th:data-date-fin="${a.dateFinEncheres}"></span>
					</td>
					<td th:text="${a.retrait?.rue + ' ' + a.retrait?.codePostal + ' ' + a.retrait?.ville}"></td>
					<td th:text="${a.utilisateur?.pseudo}"></td>
					
		
					</tr>
					
					</tbody>
					
				</table>

				
				
			</div>
			</li>
		</ul>
 
 
 <script>
 
 	function startChrono(element){
		const dateFin = new Date(element.dataset.dateFin);
		const dateDebut = new Date(element.dataset.dateDebut);
		
		
 			function updateChrono(){
				const maintenant = new Date();
				
				
				if(maintenant < dateDebut){
					element.textContent = "Enchère non commencée";
					return;
					}
				const diff = dateFin - maintenant;
				
					if(diff<= 0){
						element.textContent = "Enchère terminée";
						return;
						}
					 const jours = Math.floor(diff / (1000 * 60 * 60 * 24));
					    const heures = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
					    const secondes = Math.floor((diff % (1000 * 60)) / 1000);
			
			element.textContent=
				`${jours}j${heures.toString().padStart(2,'0')}h`+
				`${minutes.toString().padStart(2,'0')}m`+
				`${secondes.toString().padStart(2,'0')}s`;
				
				
 	}
 			updateChrono();
			        setInterval(updateChrono,1000);
 	}
 	document.addEventListener('DOMContentLoaded', () => {
		const elements=document.querySelectorAll(".compte-rebours");
		elements.forEach(el => startChrono(el));
 	});

 	
 </script>

</body>
</html>